<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∞—Ä–º–±–∞–∑–∏—Å ‚Äî –ö–≤–∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Fallback for hidden class in case Tailwind CDN fails */
        .hidden { display: none !important; }
        
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #d97706;
        }
        body { background: #f1f5f9; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        .card { background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,.1); }
        .btn { border-radius: 8px; padding: 10px 20px; font-weight: 600; cursor: pointer; transition: all .15s; border: none; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.15); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-outline { background: white; color: #374151; border: 2px solid #d1d5db; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .tag { display: inline-block; background: #e0e7ff; color: #3730a3; padding: 2px 10px; border-radius: 9999px; font-size: 0.8rem; margin: 2px; }
        .tag-remove { cursor: pointer; margin-left: 4px; color: #6366f1; }
        .tag-remove:hover { color: var(--danger); }
        textarea, input[type="text"], select {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 14px;
            width: 100%;
            font-size: 0.95rem;
            transition: border-color .15s;
        }
        textarea:focus, input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37,99,235,.1);
        }
        .progress-bar { height: 8px; border-radius: 4px; background: #e2e8f0; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; background: linear-gradient(90deg, #3b82f6, #16a34a); transition: width .5s ease; }
        .quality-badge {
            display: inline-flex; align-items: center; justify-content: center;
            width: 32px; height: 32px; border-radius: 50%; font-weight: 700; font-size: 0.9rem;
        }
        .q1 { background: #fecaca; color: #991b1b; }
        .q2 { background: #fed7aa; color: #9a3412; }
        .q3 { background: #fef08a; color: #854d0e; }
        .q4 { background: #bbf7d0; color: #166534; }
        .q5 { background: #86efac; color: #14532d; }
        .tab { padding: 10px 24px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: 600; color: #64748b; transition: all .15s; }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab:hover { color: var(--primary); }
        .stat-card { text-align: center; padding: 20px; }
        .stat-number { font-size: 2rem; font-weight: 800; }
        .stat-label { font-size: 0.85rem; color: #64748b; margin-top: 4px; }
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,.5);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .modal { background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%; }
        .toast {
            position: fixed; bottom: 24px; right: 24px;
            padding: 14px 24px; border-radius: 10px; color: white; font-weight: 600;
            z-index: 200; animation: slideIn .3s ease;
        }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .spinner { border: 3px solid #e2e8f0; border-top-color: var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin .6s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn .3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* List mode */
        .list-row { border-bottom: 1px solid #f1f5f9; padding: 12px 16px; cursor: pointer; transition: background .1s; }
        .list-row:hover { background: #f8fafc; }
        .list-row.reviewed { border-left: 4px solid var(--success); }
        .list-row.unreviewed { border-left: 4px solid #d1d5db; }
    </style>
</head>
<body>
    <div id="app" class="max-w-5xl mx-auto px-4 py-6">

        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">üíä –§–∞—Ä–º–±–∞–∑–∏—Å ‚Äî –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1>
                <p class="text-gray-500 text-sm mt-1">–ö–≤–∏–∑-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Q&A</p>
            </div>
            <div class="flex gap-2">
                <button class="btn btn-outline text-sm" onclick="loadStats()">üìä –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn btn-primary text-sm" onclick="showImportModal()">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            </div>
        </div>

        <!-- Stats -->
        <div id="stats-panel" class="card mb-6 grid grid-cols-2 md:grid-cols-5 gap-0 divide-x divide-gray-100">
            <div class="stat-card">
                <div class="stat-number text-blue-600" id="stat-total">‚Äî</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number text-green-600" id="stat-reviewed">‚Äî</div>
                <div class="stat-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number text-orange-500" id="stat-remaining">‚Äî</div>
                <div class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-number text-purple-600" id="stat-quality">‚Äî</div>
                <div class="stat-label">–°—Ä. –∫–∞—á–µ—Å—Ç–≤–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number text-green-500" id="stat-percent">‚Äî</div>
                <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
            </div>
        </div>

        <!-- Progress bar -->
        <div class="progress-bar mb-6">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-0 border-b border-gray-200 mb-6">
            <div class="tab active" data-tab="quiz" onclick="switchTab('quiz')">üéØ –ö–≤–∏–∑</div>
            <div class="tab" data-tab="list" onclick="switchTab('list')">üìã –°–ø–∏—Å–æ–∫</div>
            <div class="tab" data-tab="import" onclick="switchTab('import')">üì• –ò–º–ø–æ—Ä—Ç</div>
        </div>

        <!-- ==================== QUIZ TAB ==================== -->
        <div id="tab-quiz">
            <!-- Category filter -->
            <div class="flex gap-3 mb-4 items-center">
                <label class="text-sm font-semibold text-gray-600">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                <select id="quiz-category" class="w-64" onchange="loadNextQuiz()">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                </select>
            </div>

            <!-- Quiz card -->
            <div id="quiz-card" class="card p-6 fade-in">
                <div id="quiz-loading" class="text-center py-12">
                    <div class="spinner mx-auto mb-4"></div>
                    <p class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div id="quiz-content" class="hidden">
                    <!-- Item header -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <span class="quality-badge" id="quiz-quality">3</span>
                            <span class="text-sm font-medium text-gray-500" id="quiz-id">‚Äî</span>
                            <span class="text-sm bg-blue-50 text-blue-700 px-3 py-1 rounded-full font-medium" id="quiz-category-badge">‚Äî</span>
                        </div>
                        <button class="text-red-400 hover:text-red-600 text-sm font-medium" onclick="deleteCurrentItem()">üóë –£–¥–∞–ª–∏—Ç—å</button>
                    </div>

                    <!-- Tags -->
                    <div class="mb-4" id="quiz-tags-container">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">–¢–µ–≥–∏</label>
                        <div id="quiz-tags" class="mt-1 flex flex-wrap gap-1"></div>
                        <div class="mt-2 flex gap-2">
                            <input type="text" id="new-tag-input" placeholder="–ù–æ–≤—ã–π —Ç–µ–≥..." class="w-48 text-sm py-1 px-3" onkeydown="if(event.key==='Enter'){addTag()}">
                            <button class="btn btn-outline text-sm py-1 px-3" onclick="addTag()">+</button>
                        </div>
                    </div>

                    <!-- Question -->
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">–í–æ–ø—Ä–æ—Å</label>
                        <textarea id="quiz-question" rows="3" class="mt-1"></textarea>
                    </div>

                    <!-- Answer -->
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">–û—Ç–≤–µ—Ç</label>
                        <textarea id="quiz-answer" rows="6" class="mt-1"></textarea>
                    </div>

                    <!-- Category edit -->
                    <div class="mb-4 flex gap-4">
                        <div class="flex-1">
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="quiz-cat-edit" class="mt-1"></select>
                        </div>
                        <div class="w-32">
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ö–∞—á–µ—Å—Ç–≤–æ (1-5)</label>
                            <select id="quiz-quality-edit" class="mt-1">
                                <option value="1">1 ‚Äî –ü–ª–æ—Ö–æ–µ</option>
                                <option value="2">2 ‚Äî –°–ª–∞–±–æ–µ</option>
                                <option value="3">3 ‚Äî –°—Ä–µ–¥–Ω–µ–µ</option>
                                <option value="4">4 ‚Äî –•–æ—Ä–æ—à–µ–µ</option>
                                <option value="5">5 ‚Äî –û—Ç–ª–∏—á–Ω–æ–µ</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action buttons -->
                    <div class="flex gap-3 mt-6 pt-4 border-t border-gray-100">
                        <button class="btn btn-success flex-1 text-lg py-3" onclick="approveItem()">
                            ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
                        </button>
                        <button class="btn btn-primary flex-1 text-lg py-3" onclick="saveAndApprove()">
                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–¥–æ–±—Ä–∏—Ç—å
                        </button>
                        <button class="btn btn-outline flex-1 text-lg py-3" onclick="skipItem()">
                            ‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                        </button>
                    </div>

                    <!-- Keyboard hints -->
                    <div class="mt-3 text-center text-xs text-gray-400">
                        –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: <kbd class="bg-gray-100 px-2 py-0.5 rounded">Enter</kbd> –û–¥–æ–±—Ä–∏—Ç—å &nbsp;
                        <kbd class="bg-gray-100 px-2 py-0.5 rounded">Ctrl+S</kbd> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–¥–æ–±—Ä–∏—Ç—å &nbsp;
                        <kbd class="bg-gray-100 px-2 py-0.5 rounded">‚Üí</kbd> –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                    </div>
                </div>

                <!-- All done -->
                <div id="quiz-done" class="hidden text-center py-12">
                    <div class="text-5xl mb-4">üéâ</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">–í—Å–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã!</h2>
                    <p class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
                </div>
            </div>
        </div>

        <!-- ==================== LIST TAB ==================== -->
        <div id="tab-list" class="hidden">
            <!-- Search & Filters -->
            <div class="card p-4 mb-4">
                <div class="flex gap-3 flex-wrap">
                    <input type="text" id="list-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É..." class="flex-1 min-w-64" oninput="debounceSearch()">
                    <select id="list-category" class="w-48" onchange="loadList()">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    </select>
                    <select id="list-reviewed" class="w-40" onchange="loadList()">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="false">–ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ</option>
                        <option value="true">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ</option>
                    </select>
                    <button class="btn btn-warning text-sm" onclick="showReindexModal()">üîÑ –†–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è</button>
                </div>
            </div>

            <!-- List -->
            <div class="card overflow-hidden" id="list-container">
                <div id="list-items"></div>
                <div id="list-pagination" class="p-4 border-t border-gray-100 flex items-center justify-between"></div>
            </div>
        </div>

        <!-- ==================== IMPORT TAB ==================== -->
        <div id="tab-import" class="hidden">
            <div class="card p-8 text-center">
                <div class="text-5xl mb-4">üì•</div>
                <h2 class="text-xl font-bold mb-2">–ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö Q&A –¥–∞–Ω–Ω—ã—Ö</h2>
                <p class="text-gray-500 mb-6">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON-—Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏.<br>
                    –î—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ ID) –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã, –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –≤ –±–∞–∑—É.
                </p>
                <div class="max-w-md mx-auto">
                    <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 mb-4 hover:border-blue-400 transition-colors cursor-pointer"
                         onclick="document.getElementById('import-file').click()"
                         ondragover="event.preventDefault(); this.classList.add('border-blue-400','bg-blue-50')"
                         ondragleave="this.classList.remove('border-blue-400','bg-blue-50')"
                         ondrop="handleDrop(event)">
                        <div class="text-3xl mb-2">üìÑ</div>
                        <p class="font-medium text-gray-700">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON-—Ñ–∞–π–ª —Å—é–¥–∞</p>
                        <p class="text-sm text-gray-400 mt-1">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        <input type="file" id="import-file" accept=".json" class="hidden" onchange="handleFileSelect(event)">
                    </div>
                    <div id="import-file-info" class="hidden mb-4 text-left bg-gray-50 rounded-lg p-4">
                        <p class="font-medium" id="import-filename">‚Äî</p>
                        <p class="text-sm text-gray-500" id="import-filesize">‚Äî</p>
                    </div>
                    <button id="import-btn" class="btn btn-primary w-full text-lg py-3 disabled:opacity-50"
                            onclick="doImport()" disabled>
                        üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
                    </button>
                    <div id="import-result" class="hidden mt-4 text-left bg-green-50 border border-green-200 rounded-lg p-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="modal-overlay hidden" onclick="if(event.target===this)hideImportModal()">
        <div class="modal">
            <h3 class="text-lg font-bold mb-4">üì• –ë—ã—Å—Ç—Ä—ã–π –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <p class="text-gray-500 mb-4 text-sm">–í—ã–±–µ—Ä–∏—Ç–µ JSON-—Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º–∏ Q&A –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏.</p>
            <input type="file" id="quick-import-file" accept=".json" class="mb-4">
            <div class="flex gap-3">
                <button class="btn btn-primary flex-1" onclick="doQuickImport()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                <button class="btn btn-outline flex-1" onclick="hideImportModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Reindex Modal -->
    <div id="reindex-modal" class="modal-overlay hidden" onclick="if(event.target===this)hideReindexModal()">
        <div class="modal">
            <h3 class="text-lg font-bold mb-4">üîÑ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è</h3>
            <p class="text-gray-500 mb-4 text-sm">
                –≠—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é <code>support_tickets</code> –≤ ChromaDB –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ JSON-—Ñ–∞–π–ª–∞.
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Å–ª–µ –º–∞—Å—Å–æ–≤—ã—Ö –ø—Ä–∞–≤–æ–∫. –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è –æ–±–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ –ª–µ—Ç—É.
            </p>
            <div id="reindex-progress" class="hidden mb-4">
                <div class="flex items-center gap-3">
                    <div class="spinner"></div>
                    <span class="text-gray-600">–ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è...</span>
                </div>
            </div>
            <div id="reindex-result" class="hidden mb-4 bg-green-50 border border-green-200 rounded-lg p-3 text-sm"></div>
            <div class="flex gap-3">
                <button id="reindex-btn" class="btn btn-warning flex-1" onclick="doReindex()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                <button class="btn btn-outline flex-1" onclick="hideReindexModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <script>
    // ‚îÄ‚îÄ‚îÄ Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const API = '/api/kb';
    let currentItem = null;
    let currentItemId = null;
    let categories = {};
    let editedTags = [];
    let selectedImportFile = null;
    let searchTimeout = null;
    let listPage = 1;

    // ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.addEventListener('DOMContentLoaded', async () => {
        await loadCategories();
        await loadStats();
        await loadNextQuiz();
        setupKeyboard();
    });

    // ‚îÄ‚îÄ‚îÄ API helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function api(path, options = {}) {
        const url = API + path;
        try {
            const resp = await fetch(url, options);
            if (!resp.ok) {
                const err = await resp.json().catch(() => ({ detail: resp.statusText }));
                throw new Error(err.detail || `HTTP ${resp.status}`);
            }
            return await resp.json();
        } catch (e) {
            showToast(e.message, 'error');
            throw e;
        }
    }

    // ‚îÄ‚îÄ‚îÄ Categories ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadCategories() {
        try {
            const data = await api('/categories');
            categories = data.categories;
            const selects = ['quiz-category', 'list-category', 'quiz-cat-edit'];
            selects.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const currentVal = el.value;
                // Keep the first option (All / default)
                while (el.options.length > (id === 'quiz-cat-edit' ? 0 : 1)) {
                    el.remove(id === 'quiz-cat-edit' ? 0 : 1);
                }
                Object.entries(categories).forEach(([cat, catEn]) => {
                    const opt = new Option(cat, cat);
                    el.add(opt);
                });
                el.value = currentVal;
            });
        } catch (e) { /* ignore */ }
    }

    // ‚îÄ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadStats() {
        try {
            const s = await api('/stats');
            document.getElementById('stat-total').textContent = s.total;
            document.getElementById('stat-reviewed').textContent = s.reviewed;
            document.getElementById('stat-remaining').textContent = s.unreviewed;
            document.getElementById('stat-quality').textContent = s.avg_quality;
            const pct = s.total > 0 ? (s.reviewed / s.total * 100).toFixed(1) : 0;
            document.getElementById('stat-percent').textContent = pct + '%';
            document.getElementById('progress-fill').style.width = pct + '%';
        } catch (e) { /* ignore */ }
    }

    // ‚îÄ‚îÄ‚îÄ Quiz Mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadNextQuiz() {
        const cat = document.getElementById('quiz-category').value;
        document.getElementById('quiz-loading').classList.remove('hidden');
        document.getElementById('quiz-content').classList.add('hidden');
        document.getElementById('quiz-done').classList.add('hidden');

        try {
            const params = new URLSearchParams();
            if (cat) params.set('category', cat);
            params.set('skip_reviewed', 'true');
            const data = await api('/quiz/next?' + params);

            if (!data.item) {
                document.getElementById('quiz-loading').classList.add('hidden');
                document.getElementById('quiz-done').classList.remove('hidden');
                return;
            }

            currentItem = data.item;
            currentItemId = data.item.id;
            renderQuizItem(data.item);

            document.getElementById('quiz-loading').classList.add('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');

            // Update progress
            if (data.progress) {
                const p = data.progress;
                document.getElementById('stat-reviewed').textContent = p.reviewed;
                document.getElementById('stat-remaining').textContent = p.remaining;
                document.getElementById('stat-percent').textContent = p.percent + '%';
                document.getElementById('progress-fill').style.width = p.percent + '%';
            }
        } catch (e) {
            document.getElementById('quiz-loading').classList.add('hidden');
        }
    }

    function renderQuizItem(item) {
        const meta = item.metadata || {};
        const qs = meta.quality_score || 0;

        document.getElementById('quiz-id').textContent = item.id;
        document.getElementById('quiz-question').value = meta.question || '';
        document.getElementById('quiz-answer').value = meta.answer || '';

        // Quality badge
        const qBadge = document.getElementById('quiz-quality');
        qBadge.textContent = qs;
        qBadge.className = 'quality-badge q' + Math.max(1, Math.min(5, qs));

        // Category
        document.getElementById('quiz-category-badge').textContent = meta.category || '–ü—Ä–æ—á–µ–µ';
        document.getElementById('quiz-cat-edit').value = meta.category || '–ü—Ä–æ—á–µ–µ';
        document.getElementById('quiz-quality-edit').value = String(qs);

        // Tags
        editedTags = [...(meta.tags || [])];
        renderTags();
    }

    function renderTags() {
        const container = document.getElementById('quiz-tags');
        container.innerHTML = editedTags.map((tag, i) =>
            `<span class="tag">${tag}<span class="tag-remove" onclick="removeTag(${i})">√ó</span></span>`
        ).join('');
    }

    function addTag() {
        const input = document.getElementById('new-tag-input');
        const val = input.value.trim();
        if (val && !editedTags.includes(val)) {
            editedTags.push(val);
            renderTags();
        }
        input.value = '';
    }

    function removeTag(idx) {
        editedTags.splice(idx, 1);
        renderTags();
    }

    // ‚îÄ‚îÄ‚îÄ Quiz Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function approveItem() {
        if (!currentItemId) return;
        try {
            await api(`/items/${currentItemId}/approve`, { method: 'POST' });
            showToast('‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ!', 'success');
            await loadNextQuiz();
            await loadStats();
        } catch (e) { /* error shown by api() */ }
    }

    async function saveAndApprove() {
        if (!currentItemId) return;
        const body = {
            question: document.getElementById('quiz-question').value,
            answer: document.getElementById('quiz-answer').value,
            category: document.getElementById('quiz-cat-edit').value,
            tags: editedTags,
            quality_score: parseInt(document.getElementById('quiz-quality-edit').value) || 5,
        };
        // Find category_en
        const catEn = categories[body.category] || 'general';
        body.category_en = catEn;

        try {
            await api(`/items/${currentItemId}/save-and-approve`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body),
            });
            showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∏ –æ–¥–æ–±—Ä–µ–Ω–æ!', 'success');
            await loadNextQuiz();
            await loadStats();
        } catch (e) { /* error shown */ }
    }

    async function skipItem() {
        showToast('‚è≠ –ü—Ä–æ–ø—É—â–µ–Ω–æ', 'info');
        // Move to next by loading with skip
        if (!currentItemId) return;
        // Mark item with a temporary "skip" so it goes to the end
        // Actually we just load next ‚Äî the current one stays unreviewed
        // But we need to skip it; let's just load next page or shift
        await loadNextQuizSkipping(currentItemId);
    }

    let skippedIds = new Set();

    async function loadNextQuizSkipping(skipId) {
        if (skipId) skippedIds.add(skipId);
        const cat = document.getElementById('quiz-category').value;

        try {
            const params = new URLSearchParams();
            if (cat) params.set('category', cat);
            params.set('skip_reviewed', 'true');
            // Load a batch and find first non-skipped
            const data = await api('/items?' + new URLSearchParams({
                page: '1', page_size: '50',
                ...(cat ? { category: cat } : {}),
                reviewed: 'false',
            }));

            const candidates = (data.items || []).filter(i => !skippedIds.has(i.id));
            if (candidates.length === 0) {
                // Reset skipped and try again, or show done
                skippedIds.clear();
                await loadNextQuiz();
                return;
            }

            currentItem = candidates[0];
            currentItemId = candidates[0].id;
            renderQuizItem(candidates[0]);

            document.getElementById('quiz-loading').classList.add('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');
        } catch (e) {
            await loadNextQuiz();
        }
    }

    async function deleteCurrentItem() {
        if (!currentItemId) return;
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å ${currentItemId}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.`)) return;
        try {
            await api(`/items/${currentItemId}`, { method: 'DELETE' });
            showToast('üóë –£–¥–∞–ª–µ–Ω–æ', 'warning');
            await loadNextQuiz();
            await loadStats();
        } catch (e) { /* error shown */ }
    }

    // ‚îÄ‚îÄ‚îÄ List Mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function debounceSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => { listPage = 1; loadList(); }, 300);
    }

    async function loadList() {
        const search = document.getElementById('list-search').value;
        const cat = document.getElementById('list-category').value;
        const reviewed = document.getElementById('list-reviewed').value;

        const params = new URLSearchParams({
            page: String(listPage),
            page_size: '20',
        });
        if (search) params.set('search', search);
        if (cat) params.set('category', cat);
        if (reviewed) params.set('reviewed', reviewed);

        try {
            const data = await api('/items?' + params);
            renderList(data);
        } catch (e) { /* error shown */ }
    }

    function renderList(data) {
        const container = document.getElementById('list-items');
        if (!data.items || data.items.length === 0) {
            container.innerHTML = '<div class="p-8 text-center text-gray-400">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
            document.getElementById('list-pagination').innerHTML = '';
            return;
        }

        container.innerHTML = data.items.map(item => {
            const meta = item.metadata || {};
            const reviewed = item.reviewed ? 'reviewed' : 'unreviewed';
            const qs = meta.quality_score || 0;
            const tags = (meta.tags || []).map(t => `<span class="tag text-xs">${t}</span>`).join('');
            return `
                <div class="list-row ${reviewed}" onclick="openItemInQuiz('${item.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="quality-badge text-xs q${Math.max(1,Math.min(5,qs))}" style="width:24px;height:24px;font-size:0.75rem">${qs}</span>
                            <span class="text-xs text-gray-400 w-36 truncate" title="${item.id}">${item.id}</span>
                            <span class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full">${meta.category || ''}</span>
                            ${item.reviewed ? '<span class="text-xs text-green-600 font-medium">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>' : ''}
                        </div>
                        <div class="flex gap-1">${tags}</div>
                    </div>
                    <div class="mt-1 text-sm font-medium text-gray-800 truncate">${meta.question || '(–Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–∞)'}</div>
                    <div class="mt-0.5 text-xs text-gray-500 truncate">${(meta.answer || '').substring(0, 150)}...</div>
                </div>
            `;
        }).join('');

        // Pagination
        const pag = document.getElementById('list-pagination');
        pag.innerHTML = `
            <span class="text-sm text-gray-500">–°—Ç—Ä. ${data.page} –∏–∑ ${data.total_pages} (–≤—Å–µ–≥–æ ${data.total})</span>
            <div class="flex gap-2">
                <button class="btn btn-outline text-sm py-1 px-3" onclick="listPage=Math.max(1,listPage-1);loadList()" ${data.page <= 1 ? 'disabled' : ''}>‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn btn-outline text-sm py-1 px-3" onclick="listPage++;loadList()" ${data.page >= data.total_pages ? 'disabled' : ''}>–í–ø–µ—Ä—ë–¥ ‚Üí</button>
            </div>
        `;
    }

    async function openItemInQuiz(itemId) {
        try {
            const item = await api(`/items/${itemId}`);
            currentItem = item;
            currentItemId = item.id;
            renderQuizItem(item);
            switchTab('quiz');
            document.getElementById('quiz-loading').classList.add('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('quiz-done').classList.add('hidden');
        } catch (e) { /* error shown */ }
    }

    // ‚îÄ‚îÄ‚îÄ Import ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handleDrop(e) {
        e.preventDefault();
        e.currentTarget.classList.remove('border-blue-400', 'bg-blue-50');
        if (e.dataTransfer.files.length > 0) {
            setImportFile(e.dataTransfer.files[0]);
        }
    }

    function handleFileSelect(e) {
        if (e.target.files.length > 0) {
            setImportFile(e.target.files[0]);
        }
    }

    function setImportFile(file) {
        selectedImportFile = file;
        document.getElementById('import-file-info').classList.remove('hidden');
        document.getElementById('import-filename').textContent = file.name;
        document.getElementById('import-filesize').textContent = formatBytes(file.size);
        document.getElementById('import-btn').disabled = false;
        document.getElementById('import-result').classList.add('hidden');
    }

    async function doImport() {
        if (!selectedImportFile) return;
        const btn = document.getElementById('import-btn');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner" style="width:18px;height:18px;border-width:2px"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';

        const formData = new FormData();
        formData.append('file', selectedImportFile);

        try {
            const result = await api('/import', {
                method: 'POST',
                body: formData,
            });
            const el = document.getElementById('import-result');
            el.classList.remove('hidden');
            el.innerHTML = `
                <p class="font-medium text-green-800">‚úÖ ${result.message}</p>
                <div class="mt-2 text-sm text-green-700">
                    <div>–î–æ–±–∞–≤–ª–µ–Ω–æ: <b>${result.added}</b></div>
                    <div>–î—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω–æ: <b>${result.duplicates_skipped}</b></div>
                    ${result.errors > 0 ? `<div class="text-red-600">–û—à–∏–±–æ–∫: <b>${result.errors}</b></div>` : ''}
                </div>
            `;
            showToast(`üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: +${result.added}`, 'success');
            await loadStats();
            await loadCategories();
        } catch (e) { /* error shown */ }

        btn.disabled = false;
        btn.innerHTML = 'üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π';
    }

    function showImportModal() { document.getElementById('import-modal').classList.remove('hidden'); }
    function hideImportModal() { document.getElementById('import-modal').classList.add('hidden'); }

    async function doQuickImport() {
        const fileInput = document.getElementById('quick-import-file');
        if (!fileInput.files.length) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', 'error'); return; }

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
            const result = await api('/import', { method: 'POST', body: formData });
            showToast(`üì• +${result.added} –∑–∞–ø–∏—Å–µ–π`, 'success');
            hideImportModal();
            await loadStats();
            await loadCategories();
        } catch (e) { /* error shown */ }
    }

    // ‚îÄ‚îÄ‚îÄ Reindex ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showReindexModal() { document.getElementById('reindex-modal').classList.remove('hidden'); }
    function hideReindexModal() { document.getElementById('reindex-modal').classList.add('hidden'); }

    async function doReindex() {
        const btn = document.getElementById('reindex-btn');
        btn.disabled = true;
        document.getElementById('reindex-progress').classList.remove('hidden');
        document.getElementById('reindex-result').classList.add('hidden');

        try {
            const result = await api('/reindex', { method: 'POST' });
            const el = document.getElementById('reindex-result');
            el.classList.remove('hidden');
            el.innerHTML = `‚úÖ ${result.message}`;
            showToast('üîÑ –†–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', 'success');
        } catch (e) { /* error shown */ }

        document.getElementById('reindex-progress').classList.add('hidden');
        btn.disabled = false;
    }

    // ‚îÄ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
        document.getElementById('tab-quiz').classList.toggle('hidden', tab !== 'quiz');
        document.getElementById('tab-list').classList.toggle('hidden', tab !== 'list');
        document.getElementById('tab-import').classList.toggle('hidden', tab !== 'import');

        if (tab === 'list') { loadList(); }
    }

    // ‚îÄ‚îÄ‚îÄ Keyboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setupKeyboard() {
        document.addEventListener('keydown', (e) => {
            // Don't intercept when typing in inputs
            if (['textarea', 'input', 'select'].includes(e.target.tagName.toLowerCase())) {
                if (e.key === 'Escape') e.target.blur();
                return;
            }
            if (e.key === 'Enter') { e.preventDefault(); approveItem(); }
            if (e.key === 'ArrowRight') { e.preventDefault(); skipItem(); }
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); saveAndApprove(); }
        });
    }

    // ‚îÄ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showToast(msg, type = 'info') {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.style.background = type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : type === 'warning' ? '#d97706' : '#2563eb';
        el.classList.remove('hidden');
        setTimeout(() => el.classList.add('hidden'), 3000);
    }

    // ‚îÄ‚îÄ‚îÄ Util ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function formatBytes(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / 1048576).toFixed(1) + ' MB';
    }
    </script>
</body>
</html>
