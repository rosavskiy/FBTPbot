# ะคะฐัะผะฑะฐะทะธั ะะ-ะขะตัะฟะพะดะดะตัะถะบะฐ โ ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

## ะะณะปะฐะฒะปะตะฝะธะต

1. [ะะฑัะตะต ะพะฟะธัะฐะฝะธะต](#1-ะพะฑัะตะต-ะพะฟะธัะฐะฝะธะต)
2. [ะััะธัะตะบัััะฐ ัะธััะตะผั](#2-ะฐััะธัะตะบัััะฐ-ัะธััะตะผั)
3. [ะกัะตะบ ัะตัะฝะพะปะพะณะธะน](#3-ััะตะบ-ัะตัะฝะพะปะพะณะธะน)
4. [ะะฐะทะฐ ะทะฝะฐะฝะธะน: ะพัะบัะดะฐ ะฑะตััััั ะดะฐะฝะฝัะต](#4-ะฑะฐะทะฐ-ะทะฝะฐะฝะธะน-ะพัะบัะดะฐ-ะฑะตััััั-ะดะฐะฝะฝัะต)
5. [RAG-ะฟะฐะนะฟะปะฐะนะฝ: ะบะฐะบ ะฑะพั ะฝะฐัะพะดะธั ะธ ะณะตะฝะตัะธััะตั ะพัะฒะตั](#5-rag-ะฟะฐะนะฟะปะฐะนะฝ-ะบะฐะบ-ะฑะพั-ะฝะฐัะพะดะธั-ะธ-ะณะตะฝะตัะธััะตั-ะพัะฒะตั)
6. [ะัะธะฝััะธะต ัะตัะตะฝะธะน: ัะฒะตัะตะฝะฝะพััั ะธ ััะบะฐะปะฐัะธั](#6-ะฟัะธะฝััะธะต-ัะตัะตะฝะธะน-ัะฒะตัะตะฝะฝะพััั-ะธ-ััะบะฐะปะฐัะธั)
7. [API-ัะฝะดะฟะพะธะฝัั](#7-api-ัะฝะดะฟะพะธะฝัั)
8. [ะะตะฑ-ะธะฝัะตััะตะนั ะฟะพะปัะทะพะฒะฐัะตะปั (ัะฐั)](#8-ะฒะตะฑ-ะธะฝัะตััะตะนั-ะฟะพะปัะทะพะฒะฐัะตะปั-ัะฐั)
9. [ะะฐะฝะตะปั ะพะฟะตัะฐัะพัะฐ ัะตัะฟะพะดะดะตัะถะบะธ](#9-ะฟะฐะฝะตะปั-ะพะฟะตัะฐัะพัะฐ-ัะตัะฟะพะดะดะตัะถะบะธ)
10. [Telegram-ะธะฝัะตะณัะฐัะธั](#10-telegram-ะธะฝัะตะณัะฐัะธั)
11. [ะะฐะทะฐ ะดะฐะฝะฝัั](#11-ะฑะฐะทะฐ-ะดะฐะฝะฝัั)
12. [Docker-ะดะตะฟะปะพะน](#12-docker-ะดะตะฟะปะพะน)
13. [ะะพะฝัะธะณััะฐัะธั (.env)](#13-ะบะพะฝัะธะณััะฐัะธั-env)
14. [ะกัะตะผะฐ ะฟะพัะพะบะพะฒ ะดะฐะฝะฝัั](#14-ััะตะผะฐ-ะฟะพัะพะบะพะฒ-ะดะฐะฝะฝัั)
15. [ะะณัะฐะฝะธัะตะฝะธั ะธ ะธะทะฒะตััะฝัะต ะพัะพะฑะตะฝะฝะพััะธ](#15-ะพะณัะฐะฝะธัะตะฝะธั-ะธ-ะธะทะฒะตััะฝัะต-ะพัะพะฑะตะฝะฝะพััะธ)

---

## 1. ะะฑัะตะต ะพะฟะธัะฐะฝะธะต

**ะคะฐัะผะฑะฐะทะธั ะะ-ะขะตัะฟะพะดะดะตัะถะบะฐ** โ ะผะพะดัะปั ะธะฝัะตะปะปะตะบััะฐะปัะฝะพะน ัะตัะฟะพะดะดะตัะถะบะธ ะดะปั ะะะ ยซะคะฐัะผะฑะฐะทะธัยป (www.farmbazis.ru), ะบะพะผะฟะฐะฝะธะธ-ัะฐะทัะฐะฑะพััะธะบะฐ ะฟัะพะณัะฐะผะผะฝะพะณะพ ะพะฑะตัะฟะตัะตะฝะธั ะดะปั ะฐะฟัะตะบ.

### ะงัะพ ะดะตะปะฐะตั ัะธััะตะผะฐ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฒะตัะฐะตั ะฝะฐ ะฒะพะฟัะพัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฟะพ ัะฐะฑะพัะต ั ะฟัะพะณัะฐะผะผะพะน ะคะฐัะผะฑะฐะทะธั, ะธัะฟะพะปัะทัั **ะฑะฐะทั ะทะฝะฐะฝะธะน** โ HTML-ััะบะพะฒะพะดััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปั (542 ััะฐััะธ). ะัะปะธ ะพัะฒะตั ะฝะต ะฝะฐะนะดะตะฝ ะธะปะธ ะฑะพั ะฝะต ัะฒะตัะตะฝ โ ะฒะพะฟัะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ **ััะบะฐะปะธััะตััั** ะฝะฐ ะถะธะฒะพะณะพ ะพะฟะตัะฐัะพัะฐ ัะตัะฟะพะดะดะตัะถะบะธ.

### ะะปััะตะฒะพะน ะฟัะธะฝัะธะฟ

> **ะะพั ะะ ัะฐะฝัะฐะทะธััะตั.** ะะฝ ะพัะฒะตัะฐะตั ะขะะะฌะะ ะฝะฐ ะพัะฝะพะฒะต ะดะพะบัะผะตะฝัะฐัะธะธ. ะัะปะธ ะฒ ะฑะฐะทะต ะทะฝะฐะฝะธะน ะฝะตั ะธะฝัะพัะผะฐัะธะธ โ ัะตััะฝะพ ะณะพะฒะพัะธั ะพะฑ ััะพะผ ะธ ะฟะพะดะบะปััะฐะตั ะพะฟะตัะฐัะพัะฐ.

### ะะพะผะฟะพะฝะตะฝัั

| ะะพะผะฟะพะฝะตะฝั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|-----------|
| **ะะตะฑ-ัะฐั** | ะัะฝะพะฒะฝะพะน ะธะฝัะตััะตะนั ะฟะพะปัะทะพะฒะฐัะตะปั (http://41.216.182.31) |
| **ะงะฐั-ะฒะธะดะถะตั** | ะัััะฐะธะฒะฐะตะผัะน ะฒะธะดะถะตั ะดะปั ััะพัะพะฝะฝะธั ัััะฐะฝะธั |
| **RAG-ะดะฒะธะถะพะบ** | ะะพะธัะบ ะฟะพ ะฑะฐะทะต ะทะฝะฐะฝะธะน + ะณะตะฝะตัะฐัะธั ะพัะฒะตัะพะฒ ัะตัะตะท GPT |
| **ะะฐะฝะตะปั ะพะฟะตัะฐัะพัะฐ** | ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะพะฑัะฐะฑะพัะบะธ ััะบะฐะปะธัะพะฒะฐะฝะฝัั ะทะฐัะฒะพะบ |
| **Telegram-ะฑะพั** | ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฟะตัะฐัะพัะพะฒ ะพ ะฝะพะฒัั ะทะฐัะฒะบะฐั |

---

## 2. ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะะะฌะะะะะขะะะฌ                        โ
โ              (ะฑัะฐัะทะตั / ะฒะธะดะถะตั ะฝะฐ ัะฐะนัะต)                 โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
             โ HTTP                        โ
             โผ                            โ
โโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ   NGINX (ะฟะพัั 80)   โโโโโโโโโโโโโโโโโโโโโ
โ   - SPA-ัะพััะธะฝะณ     โ
โ   - /api/ โ backend โ
โโโโโโโโโโฌโโโโโโโโโโโโโ
         โ proxy_pass
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              FastAPI BACKEND (ะฟะพัั 8000)                 โ
โ                                                         โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ  โ
โ  โ /api/chatโ  โ/api/escalationโ  โ /api/operator    โ  โ
โ  โโโโโโฌโโโโโโ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโโโโโ  โ
โ       โ               โ                 โ               โ
โ       โผ               โผ                 โผ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ              RAG ENGINE                         โ    โ
โ  โ  1. ะะพะธัะบ ะฒ ChromaDB (similarity search)        โ    โ
โ  โ  2. ะคะพัะผะธัะพะฒะฐะฝะธะต ะบะพะฝัะตะบััะฐ                      โ    โ
โ  โ  3. ะะฐะฟัะพั ะบ OpenAI GPT-4o-mini                 โ    โ
โ  โ  4. ะะทะฒะปะตัะตะฝะธะต confidence                       โ    โ
โ  โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ    โ
โ             โ                      โ                    โ
โ     โโโโโโโโโผโโโโโโโโโ     โโโโโโโโโผโโโโโโโโโโโ        โ
โ     โ   ChromaDB     โ     โ  OpenAI API      โ        โ
โ     โ (ะฒะตะบัะพัะฝะฐั ะะ) โ     โ GPT-4o-mini      โ        โ
โ     โ 4049 ัะฐะฝะบะพะฒ    โ     โ text-embedding-  โ        โ
โ     โ                โ     โ   3-small         โ        โ
โ     โโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ        โ
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ SQLite (async)   โ  โ Telegram Notifier        โ    โ
โ  โ - ัะตััะธะธ         โ  โ - ัะฒะตะดะพะผะปะตะฝะธั ะพะฟะตัะฐัะพัะฐะผ โ    โ
โ  โ - ัะพะพะฑัะตะฝะธั      โ  โ                          โ    โ
โ  โ - ััะบะฐะปะฐัะธะธ      โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ - ะพะฑัะฐัะฝะฐั ัะฒัะทั โ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโ                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 3. ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

### Backend
| ะขะตัะฝะพะปะพะณะธั | ะะตััะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|--------|-----------|
| Python | 3.11 | ะัะฝะพะฒะฝะพะน ัะทัะบ |
| FastAPI | 0.115.6 | HTTP-ััะตะนะผะฒะพัะบ |
| Uvicorn | 0.34.0 | ASGI-ัะตัะฒะตั |
| LangChain | 0.3.14 | ะัะบะตัััะฐัะธั RAG |
| ChromaDB | 0.6.3 | ะะตะบัะพัะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั |
| OpenAI SDK | 1.59.3 | ะะฐะฑะพัะฐ ั GPT ะธ ัะผะฑะตะดะดะธะฝะณะฐะผะธ |
| SQLAlchemy | 2.0.36 | ORM (async) |
| aiosqlite | 0.20.0 | Async-ะดัะฐะนะฒะตั SQLite |
| BeautifulSoup4 | 4.12.3 | ะะฐััะธะฝะณ HTML-ะธะฝััััะบัะธะน |
| lxml | 5.3.0 | HTML-ะฟะฐััะตั (ะดะฒะธะถะพะบ ะดะปั BS4) |
| python-telegram-bot | 21.10 | Telegram API |

### Frontend
| ะขะตัะฝะพะปะพะณะธั | ะะตััะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|--------|-----------|
| React | 18 | UI-ััะตะนะผะฒะพัะบ |
| TypeScript | โ | ะขะธะฟะธะทะฐัะธั |
| Vite | โ | ะกะฑะพััะธะบ |
| react-router-dom | โ | ะะฐัััััะธะทะฐัะธั SPA |
| react-markdown | โ | ะะตะฝะดะตัะธะฝะณ Markdown-ะพัะฒะตัะพะฒ |

### ะะฝััะฐััััะบัััะฐ
| ะขะตัะฝะพะปะพะณะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|-----------|
| Docker + Docker Compose | ะะพะฝัะตะนะฝะตัะธะทะฐัะธั |
| nginx | ะะตะฒะตัั-ะฟัะพะบัะธ, ัะฐะทะดะฐัะฐ SPA |
| Ubuntu 24.04 (ะกัะพะบะณะพะปัะผ) | ะกะตัะฒะตั |

---

## 4. ะะฐะทะฐ ะทะฝะฐะฝะธะน: ะพัะบัะดะฐ ะฑะตััััั ะดะฐะฝะฝัะต

### 4.1. ะััะพัะฝะธะบ ะดะฐะฝะฝัั

ะะฐะทะฐ ะทะฝะฐะฝะธะน ัะพัะผะธััะตััั ะธะท **HTML-ัะฐะนะปะพะฒ ััะบะพะฒะพะดััะฒะฐ ะฟะพะปัะทะพะฒะฐัะตะปั** ะฟัะพะณัะฐะผะผั ะคะฐัะผะฑะฐะทะธั. ะญัะพ 542 ัะฐะนะปะฐ (ะพะฑัะธะผ ะพะฑััะผะพะผ ~520 ะะ), ะบะฐะถะดัะน ะธะท ะบะพัะพััั ะพะฟะธััะฒะฐะตั ะพัะดะตะปัะฝัั ััะฝะบัะธั ะธะปะธ ะฟัะพัะตะดััั ะฒ ะฟัะพะณัะฐะผะผะต.

ะัะธะผะตัั ัะตะผ ััะฐัะตะน:
- ะัะธัะผะบะฐ ัะพะฒะฐัะฐ
- ะะฐัััะพะนะบะฐ ะผะฐัะบะธัะพะฒะบะธ ะปะตะบะฐัััะฒะตะฝะฝัั ััะตะดััะฒ
- ะะพะฑะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะฐะฑะพัะฐ ั ะบะฐััะพะฒัะผ ะฐะฟะฟะฐัะฐัะพะผ (ะะะ)
- ะะฝะฒะตะฝัะฐัะธะทะฐัะธั
- ะะฐัััะพะนะบะฐ ะะะะ
- ะธ ั.ะด.

### 4.2. ะกัััะบัััะฐ HTML-ัะฐะนะปะพะฒ

ะะฐะถะดัะน HTML-ัะฐะนะป ัะพะดะตัะถะธั:
- **ะะฐะณะพะปะพะฒะพะบ** โ ะฝะฐะทะฒะฐะฝะธะต ะธะฝััััะบัะธะธ (ะธะทะฒะปะตะบะฐะตััั ะธะท CSS-ะบะปะฐััะพะฒ `af9`, `X1`, ะธะปะธ ะฟะตัะฒะพะณะพ ะฝะตะฟัััะพะณะพ `<p>`)
- **ะขะตะบัั** โ ะฟะพัะฐะณะพะฒะฐั ะธะฝััััะบัะธั ั ะฝัะผะตัะพะฒะฐะฝะฝัะผะธ ัะฐะณะฐะผะธ
- **ะกะบัะธะฝัะพัั** โ ะธะทะพะฑัะฐะถะตะฝะธั ะฒ ัะพัะผะฐัะต base64, ะฒัััะพะตะฝะฝัะต ะฒ HTML (ะธะทะฒะปะตะบะฐัััั ะธ ัะพััะฐะฝััััั ะพัะดะตะปัะฝะพ)
- **YouTube-ัััะปะบะธ** โ ะฒะธะดะตะพ-ะธะฝััััะบัะธะธ (ะตัะปะธ ะตััั)

ะคะฐะนะปั ะธะผะตะฝััััั ะฟะพ ID ััะฐััะธ: `1021.html`, `1068.html`, `1913.html` ะธ ั.ะด.

### 4.3. ะะฐััะธะฝะณ (ัะฐะนะป `backend/app/parser/html_parser.py`)

ะะปะฐัั `InstructionParser` ะพะฑัะฐะฑะฐััะฒะฐะตั ะบะฐะถะดัะน HTML-ัะฐะนะป:

```
HTML-ัะฐะนะป
    โ
    โโโบ ะะทะฒะปะตัะตะฝะธะต ะทะฐะณะพะปะพะฒะบะฐ (_extract_title)
    โ   ะัะตั: <p class="af9">, <p class="X1">, <span style="font-size:2*">, 
    โ   ะฟะตัะฒัะน ะฝะตะฟัััะพะน <p>
    โ
    โโโบ ะะทะฒะปะตัะตะฝะธะต ะธะทะพะฑัะฐะถะตะฝะธะน (_extract_images)
    โ   ะัะตั: <img src="data:image/...;base64,...">
    โ   ะะตะนััะฒะธะต: ะดะตะบะพะดะธััะตั base64, ัะพััะฐะฝัะตั ะฒ ./data/images/
    โ   ะคะพัะผะฐั ะธะผะตะฝะธ: {article_id}_img{idx}_{md5hash}.{format}
    โ
    โโโบ ะะทะฒะปะตัะตะฝะธะต YouTube-ัััะปะพะบ (_extract_youtube_links)
    โ   Regex: youtube.com/watch?v= ะธะปะธ youtu.be/
    โ   ะะตะดัะฟะปะธะบะฐัะธั ั ัะพััะฐะฝะตะฝะธะตะผ ะฟะพััะดะบะฐ
    โ
    โโโบ ะะทะฒะปะตัะตะฝะธะต ัะธััะพะณะพ ัะตะบััะฐ (_extract_text)
    โ   ะฃะดะฐะปัะตั: <style>, <script>, <head>, ัะตะณะธ <img>
    โ   ะะฑัะพะดะธั DOM-ะดะตัะตะฒะพ, ัะพะฑะธัะฐะตั ัะตะบััะพะฒัะต ัะทะปั
    โ   ะะพัะผะฐะปะธะทัะตั ะฟัะพะฑะตะปั ะธ ะฟะตัะตะฝะพัั ัััะพะบ
    โ
    โโโบ ะะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะตะบัะธะธ (_extract_sections)
        ะัะตั ะฟะฐััะตัะฝั: ยซะญะขะะ N.ยป, ยซ1.ยป, ยซะจะฐะณ Nยป
```

ะะตะทัะปััะฐั โ ะพะฑัะตะบั `ParsedInstruction`:
```python
@dataclass
class ParsedInstruction:
    article_id: str        # "1913"
    title: str             # "ะัะธัะผะบะฐ ัะพะฒะฐัะฐ ะฟะพ ะฒัััะฐะฒะปะตะฝะฝะพะผั ััััั"
    text_content: str      # ะะตัั ัะตะบัั ััะฐััะธ ะฑะตะท HTML
    sections: List[str]    # ะะฐะทะดะตะปั/ัะฐะณะธ
    images: List[ParsedImage]    # ะะทะพะฑัะฐะถะตะฝะธั
    youtube_links: List[str]     # YouTube-ัััะปะบะธ
    source_file: str       # ะััั ะบ ัะฐะนะปั
```

### 4.4. ะะฝะดะตะบัะฐัะธั (ัะฐะนะป `backend/app/indexer/knowledge_base.py`)

ะะปะฐัั `KnowledgeBaseIndexer` ะฟัะตะฒัะฐัะฐะตั ัะฐัะฟะฐััะตะฝะฝัะต ะธะฝััััะบัะธะธ ะฒ ะฒะตะบัะพัะฝัั ะฑะฐะทั:

```
ParsedInstruction
    โ
    โโโบ ะะฑะพะณะฐัะตะฝะธะต ัะตะบััะฐ
    โ   ะะพะฑะฐะฒะปัะตั: ะทะฐะณะพะปะพะฒะพะบ ะบะฐะบ # Title, YouTube-ัััะปะบะธ ะฒ ะบะพะฝัะต
    โ
    โโโบ ะะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะฐะฝะบะธ (RecursiveCharacterTextSplitter)
    โ   chunk_size = 800 ัะธะผะฒะพะปะพะฒ
    โ   chunk_overlap = 200 ัะธะผะฒะพะปะพะฒ (ะฟะตัะตะบัััะธะต ะดะปั ัะพััะฐะฝะตะฝะธั ะบะพะฝัะตะบััะฐ)
    โ   separators: ["\n\n", "\n", ". ", ", ", " ", ""]
    โ
    โโโบ ะคะพัะผะธัะพะฒะฐะฝะธะต ะผะตัะฐะดะฐะฝะฝัั ะดะปั ะบะฐะถะดะพะณะพ ัะฐะฝะบะฐ:
    โ   - article_id, title, source_file
    โ   - has_images, image_count
    โ   - youtube_links (JSON)
    โ   - images_info (JSON: filename + alt_text)
    โ   - chunk_index, total_chunks
    โ
    โโโบ ะะฐะฟะธัั ะฒ ChromaDB
        ะะพะดะตะปั ัะผะฑะตะดะดะธะฝะณะพะฒ: OpenAI text-embedding-3-small
        ะะพะปะปะตะบัะธั: "farmbazis_instructions"
        Persist directory: ./data/chroma_db/
```

**ะขะตะบััะฐั ััะฐัะธััะธะบะฐ:**
- 542 ััะฐััะธ โ 4049 ัะฐะฝะบะพะฒ
- 13 ััะฐัะตะน ัะพะดะตัะถะฐั YouTube-ัััะปะบะธ
- ะะฝะดะตะบัะฐัะธั ะทะฐะฝะธะผะฐะตั ~78 ัะตะบัะฝะด

### 4.5. ะะฐะฟััะบ ะธะฝะดะตะบัะฐัะธะธ

ะะฝะดะตะบัะฐัะธั ะทะฐะฟััะบะฐะตััั ะฒัััะฝัั ะบะพะผะฐะฝะดะพะน ะฒะฝัััะธ Docker-ะบะพะฝัะตะนะฝะตัะฐ backend:
```bash
docker compose exec backend python -m app.indexer
```

ะะตะทัะปััะฐั ัะพััะฐะฝัะตััั ะฒ:
- `./data/chroma_db/` โ ัะฐะนะปั ChromaDB (ัะผะฑะตะดะดะธะฝะณะธ + ะผะตัะฐะดะฐะฝะฝัะต)
- `./data/indexing_stats.json` โ ััะฐัะธััะธะบะฐ ะธะฝะดะตะบัะฐัะธะธ

---

## 5. RAG-ะฟะฐะนะฟะปะฐะนะฝ: ะบะฐะบ ะฑะพั ะฝะฐัะพะดะธั ะธ ะณะตะฝะตัะธััะตั ะพัะฒะตั

RAG (Retrieval-Augmented Generation) โ ะพัะฝะพะฒะฝะพะน ะฟัะธะฝัะธะฟ ัะฐะฑะพัั ัะธััะตะผั. ะะผะตััะพ ัะพะณะพ ััะพะฑั ะพัะฒะตัะฐัั ยซะธะท ะณะพะปะพะฒัยป, ะผะพะดะตะปั GPT ะฟะพะปััะฐะตั **ะบะพะฝัะตะบัั ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน** ะธ ัะพัะผะธััะตั ะพัะฒะตั ัััะพะณะพ ะฝะฐ ะตะณะพ ะพัะฝะพะฒะต.

### 5.1. ะะพะปะฝัะน ัะธะบะป ะพะฑัะฐะฑะพัะบะธ ะฒะพะฟัะพัะฐ

```
ะะพะปัะทะพะฒะฐัะตะปั: "ะะฐะบ ัะดะตะปะฐัั ะฟัะธัะผะบั ัะพะฒะฐัะฐ?"
         โ
         โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ ะจะะ 1. RETRIEVAL (ะฟะพะธัะบ)                   โ
    โ                                             โ
    โ ะะพะฟัะพั โ OpenAI Embeddings API              โ
    โ (text-embedding-3-small)                    โ
    โ โ ะฒะตะบัะพั [0.012, -0.034, 0.089, ...]       โ
    โ                                             โ
    โ ะะตะบัะพั โ ChromaDB similarity_search         โ
    โ โ Top-5 ะฝะฐะธะฑะพะปะตะต ะฟะพัะพะถะธั ัะฐะฝะบะพะฒ             โ
    โ โ ะคะธะปัััะฐัะธั ะฟะพ ะฟะพัะพะณั ัะตะปะตะฒะฐะฝัะฝะพััะธ (0.3)  โ
    โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ ะจะะ 2. AUGMENTATION (ะพะฑะพะณะฐัะตะฝะธะต)            โ
    โ                                             โ
    โ ะคะพัะผะธััะตััั ะฟัะพะผะฟั ะธะท 3 ัะฐััะตะน:             โ
    โ                                             โ
    โ [SYSTEM] ะขั โ ะะ-ะฐััะธััะตะฝั ะคะฐัะผะฑะฐะทะธั...     โ
    โ   ะัะฐะฒะธะปะฐ: ะพัะฒะตัะฐะน ะขะะะฌะะ ะธะท ะบะพะฝัะตะบััะฐ,     โ
    โ   ะฝะต ะฒัะดัะผัะฒะฐะน, ะดะฐะฒะฐะน ะฟะพัะฐะณะพะฒัะต ะธะฝััััะบัะธะธ, โ
    โ   ะฟัะธะบัะตะฟะปัะน YouTube/ัะบัะธะฝัะพัั...           โ
    โ   + ัะพัะผะฐั ะพัะตะฝะบะธ confidence (JSON)         โ
    โ                                             โ
    โ [HISTORY] ะะพัะปะตะดะฝะธะต 6 ัะพะพะฑัะตะฝะธะน ัะฐัะฐ        โ
    โ                                             โ
    โ [USER] ะะะะขะะะกะข: {5 ะฝะฐะนะดะตะฝะฝัั ัะฐะฝะบะพะฒ}       โ
    โ        ะะะะะะก: {ะฒะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั}        โ
    โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ ะจะะ 3. GENERATION (ะณะตะฝะตัะฐัะธั)               โ
    โ                                             โ
    โ OpenAI Chat Completion API                  โ
    โ ะะพะดะตะปั: gpt-4o-mini                         โ
    โ temperature: 0.1 (ะฟะพััะธ ะดะตัะตัะผะธะฝะธัะพะฒะฐะฝะฝัะน)  โ
    โ max_tokens: 2000                            โ
    โ                                             โ
    โ ะัะฒะตั ัะพะดะตัะถะธั:                             โ
    โ - ะขะตะบัั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั                    โ
    โ - JSON-ะฑะปะพะบ confidence (ัะบััััะน):           โ
    โ   {"confidence": 0.95,                      โ
    โ    "reason": "ะะฐะนะดะตะฝะฐ ัะพัะฝะฐั ะธะฝััััะบัะธั"}   โ
    โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ ะจะะ 4. POST-PROCESSING (ะพะฑัะฐะฑะพัะบะฐ)          โ
    โ                                             โ
    โ 1. ะะทะฒะปะตัะตะฝะธะต confidence ะธะท JSON-ะฑะปะพะบะฐ      โ
    โ    (regex-ะฟะฐััะธะฝะณ ```confidence {...} ```)   โ
    โ 2. ะัะธััะบะฐ ะพัะฒะตัะฐ ะพั ัะปัะถะตะฑะฝะพะณะพ JSON        โ
    โ 3. ะกะฑะพั YouTube-ัััะปะพะบ ะธะท ะผะตัะฐะดะฐะฝะฝัั ัะฐะฝะบะพะฒ โ
    โ 4. ะกะฑะพั ะธะฝัะพัะผะฐัะธะธ ะพะฑ ะธะทะพะฑัะฐะถะตะฝะธัั          โ
    โ 5. ะะฟัะตะดะตะปะตะฝะธะต: ะฝัะถะฝะฐ ะปะธ ััะบะฐะปะฐัะธั?         โ
    โ    (confidence < 0.3 โ ััะบะฐะปะฐัะธั)           โ
    โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
    ะัะฒะตั ะฟะพะปัะทะพะฒะฐัะตะปั + ะผะตัะฐะดะฐะฝะฝัะต
```

### 5.2. ะกะธััะตะผะฝัะน ะฟัะพะผะฟั (System Prompt)

ะะปััะตะฒะพะน ัะปะตะผะตะฝั โ **ัะธััะตะผะฝัะน ะฟัะพะผะฟั**, ะบะพัะพััะน ะทะฐะดะฐัั ะฟะพะฒะตะดะตะฝะธะต GPT:

```
ะขั โ ะะ-ะฐััะธััะตะฝั ัะตัะฟะพะดะดะตัะถะบะธ ะบะพะผะฟะฐะฝะธะธ ะะะ ยซะคะฐัะผะฑะฐะทะธัยป.

ะะะะะะะ:
1. ะัะฒะตัะฐะน ะขะะะฌะะ ะฝะฐ ะพัะฝะพะฒะต ะฟัะตะดะพััะฐะฒะปะตะฝะฝะพะณะพ ะบะพะฝัะตะบััะฐ ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน.
2. ะัะปะธ ะฒ ะบะพะฝัะตะบััะต ะฝะตั ะธะฝัะพัะผะฐัะธะธ โ ะะ ะะซะะฃะะซะะะ.
3. ะะฐะฒะฐะน ะฟะพัะฐะณะพะฒัะต, ะฟะพะดัะพะฑะฝัะต ะธะฝััััะบัะธะธ.
4. ะัะปะธ ะตััั ัะบัะธะฝัะพัั โ ัะฟะพะผัะฝะธ ะธั.
5. ะัะปะธ ะตััั ะฒะธะดะตะพ-ะธะฝััััะบัะธั โ ะดะฐะน ัััะปะบั.
6. ะะตะถะปะธะฒัะน, ะฟัะพัะตััะธะพะฝะฐะปัะฝัะน ัะพะฝ.
7. ะัะฒะตัะฐะน ะฝะฐ ััััะบะพะผ ัะทัะบะต.
8. ะะต ัะฐัะบััะฒะฐะน ะฒะฝัััะตะฝะฝัั ะผะตัะฐะฝะธะบั.
```

### 5.3. ะะฐัะฐะผะตััั retrieval

| ะะฐัะฐะผะตัั | ะะฝะฐัะตะฝะธะต | ะะฟะธัะฐะฝะธะต |
|----------|---------|----------|
| `rag_top_k` | 5 | ะกะบะพะปัะบะพ ัะฐะฝะบะพะฒ ะธะทะฒะปะตะบะฐัั ะธะท ChromaDB |
| `rag_confidence_threshold` | 0.3 | ะะพัะพะณ ัะตะปะตะฒะฐะฝัะฝะพััะธ (ะฝะธะถะต โ ะพัะฑัะฐััะฒะฐะตะผ) |
| `rag_chunk_size` | 800 | ะะฐะทะผะตั ัะฐะฝะบะฐ ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ (ัะธะผะฒะพะปั) |
| `rag_chunk_overlap` | 200 | ะะตัะตะบัััะธะต ัะฐะฝะบะพะฒ (ัะธะผะฒะพะปั) |
| `temperature` | 0.1 | ะขะตะผะฟะตัะฐัััะฐ GPT (ะฝะธะทะบะฐั = ัะพัะฝะตะต) |

---

## 6. ะัะธะฝััะธะต ัะตัะตะฝะธะน: ัะฒะตัะตะฝะฝะพััั ะธ ััะบะฐะปะฐัะธั

### 6.1. ะะตัะฐะฝะธะทะผ confidence (ัะฒะตัะตะฝะฝะพััะธ)

ะะพั ะธัะฟะพะปัะทัะตั **ะดะฒััััะพะฒะฝะตะฒัั ัะธััะตะผั ะพัะตะฝะบะธ ัะฒะตัะตะฝะฝะพััะธ**:

#### ะฃัะพะฒะตะฝั 1: ะคะธะปัััะฐัะธั ะฝะฐ ััะฐะฟะต ะฟะพะธัะบะฐ

ะัะธ ะฟะพะธัะบะต ะฒ ChromaDB (`similarity_search_with_relevance_scores`) ะบะฐะถะดัะน ะฝะฐะนะดะตะฝะฝัะน ัะฐะฝะบ ะฟะพะปััะฐะตั **score ัะตะปะตะฒะฐะฝัะฝะพััะธ** (0.0โ1.0). ะงะฐะฝะบะธ ัะพ score ะฝะธะถะต `rag_confidence_threshold` (0.3) ะพัะฑัะฐััะฒะฐัััั.

**ะัะปะธ ะฟะพัะปะต ัะธะปัััะฐัะธะธ ะฝะต ะพััะฐะปะพัั ะฝะธ ะพะดะฝะพะณะพ ัะฐะฝะบะฐ** โ ะฑะพั ััะฐะทั ะฒะพะทะฒัะฐัะฐะตั:
- `confidence = 0.0`
- `needs_escalation = True`
- ะขะตะบัั: ยซะ ัะพะถะฐะปะตะฝะธั, ั ะฝะต ะฝะฐััะป ะฟะพะดัะพะดััะตะน ะธะฝัะพัะผะฐัะธะธ...ยป
- GPT **ะฝะต ะฒัะทัะฒะฐะตััั** (ัะบะพะฝะพะผะธั ัะพะบะตะฝะพะฒ)

#### ะฃัะพะฒะตะฝั 2: ะกะฐะผะพะพัะตะฝะบะฐ GPT

ะัะปะธ ัะฐะฝะบะธ ะฝะฐะนะดะตะฝั, GPT ะณะตะฝะตัะธััะตั ะพัะฒะตั ะธ **ัะฐะผ ะพัะตะฝะธะฒะฐะตั ัะฒะพั ัะฒะตัะตะฝะฝะพััั** ะฒ ัะบัััะพะผ JSON-ะฑะปะพะบะต:

```json
{"confidence": 0.85, "reason": "ะะฐะนะดะตะฝะฐ ะฟะพะดัะพะฑะฝะฐั ะธะฝััััะบัะธั ะฟะพ ะฟัะธัะผะบะต ัะพะฒะฐัะฐ"}
```

ะญัะพั ะฑะปะพะบ:
- ะะตะฒะธะดะธะผ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั (ะฒััะตะทะฐะตััั regex-ะฟะฐััะตัะพะผ)
- ะัะฟะพะปัะทัะตััั ะดะปั ะฟัะธะฝััะธั ัะตัะตะฝะธั ะพะฑ ััะบะฐะปะฐัะธะธ

### 6.2. ะจะบะฐะปะฐ ัะฒะตัะตะฝะฝะพััะธ

| ะะธะฐะฟะฐะทะพะฝ | ะะฝัะตัะฟัะตัะฐัะธั | ะะตะนััะฒะธะต |
|----------|-------------|---------|
| **0.0โ0.3** | ะัะฒะตั ะฝะต ะฝะฐะนะดะตะฝ | โ๏ธ ะะฒัะพะผะฐัะธัะตัะบะฐั ััะบะฐะปะฐัะธั |
| **0.3โ0.6** | ะงะฐััะธัะฝัะน ะพัะฒะตั | ะัะฒะตั ะฟะพะบะฐะทัะฒะฐะตััั, ะฟัะตะดะปะฐะณะฐะตััั ัะฒัะทะฐัััั ั ะพะฟะตัะฐัะพัะพะผ |
| **0.6โ1.0** | ะฃะฒะตัะตะฝะฝัะน ะพัะฒะตั | โ ะัะฒะตั ะฟะพะบะฐะทัะฒะฐะตััั ะฑะตะท ััะบะฐะปะฐัะธะธ |

### 6.3. ะะปะณะพัะธัะผ ะฟัะธะฝััะธั ัะตัะตะฝะธั

```
                    ะะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั
                           โ
                           โผ
                 โโโโ ChromaDB ะฟะพะธัะบ โโโโ
                 โ  top-5, score โฅ 0.3  โ
                 โโโโโโโโโโโโฌโโโโโโโโโโโโ
                            โ
              โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
              โ             โ              โ
        0 ัะตะทัะปััะฐัะพะฒ  1-5 ัะตะทัะปััะฐัะพะฒ     โ
              โ             โ              โ
              โผ             โผ              โ
    confidence=0.0    ะะฐะฟัะพั ะบ GPT         โ
    ะญะกะะะะะฆะะฏ         ั ะบะพะฝัะตะบััะพะผ         โ
                            โ              โ
                            โผ              โ
                    GPT ะฒะพะทะฒัะฐัะฐะตั         โ
                    confidence=X           โ
                            โ              โ
                 โโโโโโโโโโโโผโโโโโโโโโโโ   โ
                 โ          โ          โ   โ
              X < 0.3    0.3โ0.6    X โฅ 0.6
                 โ          โ          โ
                 โผ          โผ          โผ
            ะญะกะะะะะฆะะฏ   ะัะฒะตั +    ะฃะฒะตัะตะฝะฝัะน
                        ะฟัะตะดะปะพะถะธัั   ะพัะฒะตั
                        ะพะฟะตัะฐัะพัะฐ
```

### 6.4. ะงัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ััะบะฐะปะฐัะธะธ

1. ะะฐ ััะพะฝัะตะฝะดะต ะฟะพัะฒะปัะตััั ะฑะปะพะบ: ยซะะต ัะดะฐะปะพัั ะฝะฐะนัะธ ัะพัะฝัะน ะพัะฒะตั. ะฅะพัะธัะต ัะฒัะทะฐัััั ั ะพะฟะตัะฐัะพัะพะผ?ยป
2. ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ัะบะฐะทะฐัั:
   - ะะพะฝัะฐะบัะฝัะต ะดะฐะฝะฝัะต (email/ัะตะปะตัะพะฝ) โ ะฝะตะพะฑัะทะฐัะตะปัะฝะพ
   - ะฃัะพัะฝะตะฝะธะต ะฒะพะฟัะพัะฐ โ ะฝะตะพะฑัะทะฐัะตะปัะฝะพ
3. ะกะพะทะดะฐัััั ะทะฐัะฒะบะฐ (Escalation) ะฒ ะะ ัะพ ััะฐัััะพะผ `pending`
4. ะัะฟัะฐะฒะปัะตััั ัะฒะตะดะพะผะปะตะฝะธะต ะฒ **Telegram-ัะฐั** ะพะฟะตัะฐัะพัะพะฒ
5. ะะฟะตัะฐัะพั ะฒะธะดะธั ะทะฐัะฒะบั ะฒ **ะฟะฐะฝะตะปะธ ะพะฟะตัะฐัะพัะฐ** ะธ ะผะพะถะตั ะพัะฒะตัะธัั

---

## 7. API-ัะฝะดะฟะพะธะฝัั

### 7.1. ะงะฐั (`/api/chat`)

#### `POST /api/chat` โ ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั

**ะะฐะฟัะพั:**
```json
{
  "message": "ะะฐะบ ัะดะตะปะฐัั ะฟัะธัะผะบั ัะพะฒะฐัะฐ?",
  "session_id": null  // ะธะปะธ UUID ัััะตััะฒัััะตะน ัะตััะธะธ
}
```

**ะัะฒะตั:**
```json
{
  "answer": "ะะปั ะฒัะฟะพะปะฝะตะฝะธั ะฟัะธัะผะบะธ ัะพะฒะฐัะฐ...",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "confidence": 1.0,
  "needs_escalation": false,
  "source_articles": ["2411", "1913", "2488"],
  "youtube_links": [],
  "has_images": false
}
```

**ะะพะณะธะบะฐ:**
1. ะัะปะธ `session_id` ะฝะต ัะบะฐะทะฐะฝ โ ัะพะทะดะฐัั ะฝะพะฒัั ัะตััะธั (UUID v4)
2. ะกะพััะฐะฝัะตั ัะพะพะฑัะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ SQLite
3. ะะฐะณััะถะฐะตั ะธััะพัะธั ัะฐัะฐ (ะดะพ 10 ะฟะพัะปะตะดะฝะธั ัะพะพะฑัะตะฝะธะน)
4. ะัะทัะฒะฐะตั `RAGEngine.ask()` ั ะฒะพะฟัะพัะพะผ ะธ ะธััะพัะธะตะน
5. ะกะพััะฐะฝัะตั ะพัะฒะตั ะฑะพัะฐ ะฒ SQLite
6. ะะพะทะฒัะฐัะฐะตั ะพัะฒะตั ั ะผะตัะฐะดะฐะฝะฝัะผะธ

### 7.2. ะญัะบะฐะปะฐัะธั (`/api/escalation`)

#### `POST /api/escalation` โ ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะบะธ

**ะะฐะฟัะพั:**
```json
{
  "session_id": "550e8400-...",
  "reason": "ะะต ะฝะฐััะป ะฝัะถะฝัั ััะฝะบัะธั",
  "contact_info": "user@example.com"
}
```

**ะัะฒะตั:**
```json
{
  "escalation_id": "uuid...",
  "status": "pending",
  "message": "ะะฐั ะทะฐะฟัะพั ะฟะตัะตะดะฐะฝ ะพะฟะตัะฐัะพัั. ะั 1-ะน ะฒ ะพัะตัะตะดะธ.",
  "position_in_queue": 1
}
```

**ะะพะณะธะบะฐ:**
1. ะะฐะณััะถะฐะตั ะธััะพัะธั ัะฐัะฐ
2. ะะฐัะพะดะธั ะฟะพัะปะตะดะฝะธะน ะฒะพะฟัะพั ะธ ะพัะฒะตั ะฑะพัะฐ
3. ะกะพะทะดะฐัั Escalation ะฒ ะะ (status=pending)
4. ะคะพัะผะธััะตั ัะฒะพะดะบั ะดะธะฐะปะพะณะฐ (ะฟะพัะปะตะดะฝะธะต 6 ัะพะพะฑัะตะฝะธะน)
5. ะัะฟัะฐะฒะปัะตั ัะฒะตะดะพะผะปะตะฝะธะต ะฒ Telegram
6. ะกัะธัะฐะตั ะฟะพะทะธัะธั ะฒ ะพัะตัะตะดะธ (ะบะพะป-ะฒะพ pending-ััะบะฐะปะฐัะธะน)

#### `POST /api/escalation/feedback` โ ะะฑัะฐัะฝะฐั ัะฒัะทั

**ะะฐะฟัะพั:**
```json
{
  "session_id": "uuid...",
  "rating": 5,
  "message_index": 3,
  "comment": "ะัะตะฝั ะฟะพะผะพะณะปะพ!"
}
```

### 7.3. ะะฐะฝะตะปั ะพะฟะตัะฐัะพัะฐ (`/api/operator`)

ะัะต ัะฝะดะฟะพะธะฝัั (ะบัะพะผะต login) ััะตะฑััั **Bearer-ัะพะบะตะฝ** ะฒ ะทะฐะณะพะปะพะฒะบะต `Authorization`.

#### `POST /api/operator/login` โ ะะฒัะพัะธะทะฐัะธั

**ะะฐะฟัะพั:**
```json
{
  "username": "admin",
  "password": "<ะฒะฐั_ะฟะฐัะพะปั>"
}
```

**ะัะฒะตั:**
```json
{
  "token": "random-32-byte-token",
  "username": "admin"
}
```

ะขะพะบะตะฝ ะดะตะนััะฒัะตั **12 ัะฐัะพะฒ**. ะฅัะฐะฝะตะฝะธะต: in-memory dict (ะฝะต Redis).

#### `GET /api/operator/escalations` โ ะกะฟะธัะพะบ ะทะฐัะฒะพะบ

**ะะฐัะฐะผะตััั:** `?status=pending&limit=50&offset=0`

ะะพะทะฒัะฐัะฐะตั ัะฟะธัะพะบ ััะบะฐะปะฐัะธะน ั ะฟะพะปะฝะพะน ะธััะพัะธะตะน ัะฐัะฐ ะบะฐะถะดะพะน.

#### `POST /api/operator/reply` โ ะัะฒะตั ะพะฟะตัะฐัะพัะฐ

**ะะฐะฟัะพั:**
```json
{
  "escalation_id": "uuid...",
  "message": "ะะปั ะพะฑะฝะพะฒะปะตะฝะธั ะฟัะพะณัะฐะผะผั...",
  "close_ticket": true
}
```

**ะะพะณะธะบะฐ:**
1. ะะพะฑะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต ะพะฟะตัะฐัะพัะฐ ะฒ ะธััะพัะธั ัะฐัะฐ (ั ะผะตัะบะพะน `[ะะฟะตัะฐัะพั ะขะ]`)
2. ะะฑะฝะพะฒะปัะตั ััะฐััั ััะบะฐะปะฐัะธะธ (`in_progress` ะธะปะธ `resolved`)
3. ะฃะฒะตะดะพะผะปัะตั ะฒ Telegram

### 7.4. ะกะธััะตะผะฝัะต

#### `GET /api/health` โ ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั

```json
{
  "status": "ok",
  "version": "1.0.0",
  "knowledge_base_ready": true,
  "total_articles": 542,
  "total_chunks": 4049
}
```

---

## 8. ะะตะฑ-ะธะฝัะตััะตะนั ะฟะพะปัะทะพะฒะฐัะตะปั (ัะฐั)

**URL:** `http://41.216.182.31/`

### ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั

- **ะงะฐั ั ะฑะพัะพะผ** โ ะฒะฒะพะด ะฒะพะฟัะพัะฐ โ ะฟะพะปััะตะฝะธะต ะพัะฒะตัะฐ ะฒ ัะพัะผะฐัะต Markdown
- **ะกะตััะธะธ** โ ะบะฐะถะดัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั ัะฝะธะบะฐะปัะฝัะน `session_id`, ะธััะพัะธั ัะพััะฐะฝัะตััั
- **YouTube-ัััะปะบะธ** โ ะตัะปะธ ะฒ ะธััะพัะฝะธะบะฐั ะตััั ะฒะธะดะตะพ, ะพัะพะฑัะฐะถะฐัััั ะบะฐะบ ะบะปะธะบะฐะฑะตะปัะฝัะต ัััะปะบะธ
- **ะญัะบะฐะปะฐัะธั** โ ะฟัะธ `needs_escalation=true` ะฟะพัะฒะปัะตััั ะฑะปะพะบ ั ัะพัะผะพะน ะพะฑัะฐัะตะฝะธั ะบ ะพะฟะตัะฐัะพัั
- **ะะฑัะฐัะฝะฐั ัะฒัะทั** โ ะบะฝะพะฟะบะธ ๐/๐ ะฟะพะด ะบะฐะถะดัะผ ะพัะฒะตัะพะผ ะฑะพัะฐ (ะพัะตะฝะบะฐ 5 ะธะปะธ 1)
- **ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ** โ ะฐะฝะธะผะฐัะธั ะฝะฐะฑะพัะฐ ัะตะบััะฐ, ะฟะพะบะฐ GPT ะณะตะฝะตัะธััะตั ะพัะฒะตั
- **Markdown-ัะตะฝะดะตัะธะฝะณ** โ ะพัะฒะตัั ะฑะพัะฐ ะฟะพะดะดะตัะถะธะฒะฐัั ัะพัะผะฐัะธัะพะฒะฐะฝะธะต (ัะฟะธัะบะธ, ะถะธัะฝัะน ัะตะบัั, ะทะฐะณะพะปะพะฒะบะธ)
- **Enter ะดะปั ะพัะฟัะฐะฒะบะธ** โ Shift+Enter ะดะปั ะฟะตัะตะฝะพัะฐ ัััะพะบะธ

### ะงะฐั-ะฒะธะดะถะตั

ะะพะผะฟะพะฝะตะฝั `ChatWidget` โ ะฟะปะฐะฒะฐััะธะน ะฒะธะดะถะตั ัะฐัะฐ, ะดะพัััะฟะฝัะน ะฝะฐ ะฒัะตั ัััะฐะฝะธัะฐั ะฟัะธะปะพะถะตะฝะธั. ะะพะถะตั ะฑััั ะฒัััะพะตะฝ ะฝะฐ ะฒะฝะตัะฝะธะต ัะฐะนัั.

---

## 9. ะะฐะฝะตะปั ะพะฟะตัะฐัะพัะฐ ัะตัะฟะพะดะดะตัะถะบะธ

**URL:** `http://41.216.182.31/operator`
**ะฃัััะฝัะต ะดะฐะฝะฝัะต:** admin / <ะฟะฐัะพะปั ะธะท .env>

### ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั

1. **ะะฒัะพัะธะทะฐัะธั** โ ัะพัะผะฐ ะปะพะณะธะฝ/ะฟะฐัะพะปั, Bearer-ัะพะบะตะฝ ะฝะฐ 12 ัะฐัะพะฒ
2. **ะกะฟะธัะพะบ ะทะฐัะฒะพะบ** โ ะปะตะฒะฐั ะฟะฐะฝะตะปั, ะพะฑะฝะพะฒะปะตะฝะธะต ะบะฐะถะดัะต 15 ัะตะบัะฝะด
3. **ะคะธะปัััั:** ะัะต / ะะถะธะดะฐัั / ะ ัะฐะฑะพัะต / ะะตัะตะฝะพ
4. **ะะตะนะดะถ pending** โ ะฟะพะบะฐะทัะฒะฐะตั ะบะพะปะธัะตััะฒะพ ะพะถะธะดะฐััะธั ะทะฐัะฒะพะบ
5. **ะะตัะฐะปัะฝัะน ะฟัะพัะผะพัั:**
   - ะะพะปะฝะฐั ะธััะพัะธั ัะฐัะฐ (ัะพะพะฑัะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั + ะพัะฒะตัั ะฑะพัะฐ)
   - ะัะธัะธะฝะฐ ััะบะฐะปะฐัะธะธ
   - ะะพะฝัะฐะบัะฝัะต ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะกัะฐััั ะทะฐัะฒะบะธ (ัะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั)
6. **ะัะฒะตั ะพะฟะตัะฐัะพัะฐ:**
   - ะขะตะบััะพะฒะพะต ะฟะพะปะต ะดะปั ะพัะฒะตัะฐ
   - ะงะตะบะฑะพะบั ยซะะฐะบัััั ะทะฐัะฒะบัยป
   - ะัะฒะตั ะดะพะฑะฐะฒะปัะตััั ะฒ ัะฐั ะบะฐะบ `[ะะฟะตัะฐัะพั ะขะ] ...`

### ะกัะฐัััั ััะบะฐะปะฐัะธะน

| ะกัะฐััั | ะะบะพะฝะบะฐ | ะะฟะธัะฐะฝะธะต |
|--------|--------|----------|
| `pending` | โณ ะะถะธะดะฐะตั | ะะพะฒะฐั ะทะฐัะฒะบะฐ, ะพะฟะตัะฐัะพั ะฝะต ะฒะทัะป |
| `in_progress` | ๐ ะ ัะฐะฑะพัะต | ะะฟะตัะฐัะพั ะพัะฒะตัะธะป, ะทะฐัะฒะบะฐ ะพัะบัััะฐ |
| `resolved` | โ ะะตัะตะฝะพ | ะะฟะตัะฐัะพั ะทะฐะบััะป ะทะฐัะฒะบั |
| `closed` | ๐ ะะฐะบัััะพ | ะััะธะฒ |

---

## 10. Telegram-ะธะฝัะตะณัะฐัะธั

### ะะฐะทะฝะฐัะตะฝะธะต

Telegram-ะฑะพั ะพัะฟัะฐะฒะปัะตั **ัะฒะตะดะพะผะปะตะฝะธั ะพะฟะตัะฐัะพัะฐะผ** ะพ ะฝะพะฒัั ััะบะฐะปะฐัะธัั. ะญัะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะผะณะฝะพะฒะตะฝะฝะพะต ัะตะฐะณะธัะพะฒะฐะฝะธะต ะดะฐะถะต ะตัะปะธ ะพะฟะตัะฐัะพั ะฝะต ัะผะพััะธั ะฒะตะฑ-ะฟะฐะฝะตะปั.

### ะคะพัะผะฐั ัะฒะตะดะพะผะปะตะฝะธั

ะัะธ ัะพะทะดะฐะฝะธะธ ััะบะฐะปะฐัะธะธ ะฒ Telegram-ัะฐั ะพัะฟัะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต:

```
๐ ะะะะะฏ ะะะฏะะะ ะะ ะขะะฅะะะะะะะะะฃ

๐ ID ะทะฐัะฒะบะธ: abc12345
๐ฌ ะะพะฟัะพั: ะะฐะบ ะพะฑะฝะพะฒะธัั ะฟัะพะณัะฐะผะผั?
๐ค ะะพั ะพัะฒะตัะธะป: ะ ัะพะถะฐะปะตะฝะธั, ั ะฝะต ะฝะฐััะป...
๐ ะัะธัะธะฝะฐ: ะะต ะฝะฐััะป ะฝัะถะฝัั ััะฝะบัะธั
๐ ะะพะฝัะฐะบั: user@example.com

๐ ะัะฐัะบะฐั ะธััะพัะธั:
๐ค ะะฐะบ ะพะฑะฝะพะฒะธัั ะฟัะพะณัะฐะผะผั?
๐ค ะ ัะพะถะฐะปะตะฝะธั, ั ะฝะต ะฝะฐััะป ะฟะพะดัะพะดััะตะน ะธะฝัะพัะผะฐัะธะธ...
```

### ะะฐัััะพะนะบะฐ

- `TELEGRAM_BOT_TOKEN` โ ัะพะบะตะฝ ะฑะพัะฐ ะธะท @BotFather
- `TELEGRAM_SUPPORT_CHAT_ID` โ ID ัะฐัะฐ/ะณััะฟะฟั ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน

---

## 11. ะะฐะทะฐ ะดะฐะฝะฝัั

### ะกัะตะผะฐ SQLite

```
โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโ
โ   chat_sessions     โ     โ   chat_messages      โ
โโโโโโโโโโโโโโโโโโโโโโโค     โโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID, PK)       โโโโโโ id (INT, PK, auto)  โ
โ created_at          โ   โโ session_id (FK)      โโโโบ
โ updated_at          โ   โโ role (user/assistant) โ
โ user_ip             โ   โโ content              โ
โ user_agent          โ   โโ confidence           โ
โโโโโโโโโโโโโโโโโโโโโโโ   โโ source_articles (JSON)โ
                          โโ created_at           โ
โโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโ
โ   escalations       โ   โ
โโโโโโโโโโโโโโโโโโโโโโโค   โโโโโโโโโโโโโโโโโโโโโโโโ
โ id (UUID, PK)       โ   โโ   feedback           โ
โ session_id (FK)     โโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ status              โ    โ id (INT, PK)         โ
โ reason              โ    โ session_id (FK)      โ
โ contact_info        โ    โ message_index        โ
โ operator_notes      โ    โ rating (1-5)         โ
โ operator_id         โ    โ comment              โ
โ telegram_message_id โ    โ created_at           โ
โ created_at          โ    โโโโโโโโโโโโโโโโโโโโโโโ
โ updated_at          โ
โโโโโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโ
                           โ   operators          โ
                           โโโโโโโโโโโโโโโโโโโโโโโค
                           โ id (INT, PK)         โ
                           โ username (UNIQUE)    โ
                           โ password_hash        โ
                           โ display_name         โ
                           โ telegram_user_id     โ
                           โ is_active            โ
                           โ created_at           โ
                           โโโโโโโโโโโโโโโโโโโโโโโ
```

### ะฅัะฐะฝะธะผัะต ะดะฐะฝะฝัะต

- **chat_sessions** โ ะบะฐะถะดัะน ะฒะธะทะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ัะฐั (IP, user-agent)
- **chat_messages** โ ะฟะพะปะฝะฐั ะธััะพัะธั ะฟะตัะตะฟะธัะบะธ (ะฒะบะปััะฐั ะพัะฒะตัั ะพะฟะตัะฐัะพัะฐ)
- **escalations** โ ะทะฐัะฒะบะธ ะฝะฐ ะถะธะฒัั ะฟะพะดะดะตัะถะบั ัะพ ััะฐัััะฐะผะธ
- **feedback** โ ะพัะตะฝะบะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน (๐/๐)
- **operators** โ ััััะฝัะต ะทะฐะฟะธัะธ ะพะฟะตัะฐัะพัะพะฒ (ะฟะพะบะฐ ะฝะต ะธัะฟะพะปัะทัะตััั, ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท ะดะตะผะพ-ะฐะบะบะฐัะฝั)

---

## 12. Docker-ะดะตะฟะปะพะน

### ะกะตัะฒะธัั

```yaml
services:
  backend:   # Python FastAPI + RAG + ChromaDB
    ports: 8000:8000
    volumes:
      - ./backend/data:/app/data        # ะะ + ChromaDB + ะธะทะพะฑัะฐะถะตะฝะธั
      - ./instructions:/app/instructions:ro  # HTML-ะธะฝััััะบัะธะธ (read-only)

  frontend:  # React SPA + nginx
    ports: 80:80
    depends_on: backend
```

### ะะพััั

| ะะพัั | ะกะตัะฒะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|------|--------|-----------|
| **80** | nginx (frontend) | ะะตะฑ-ะธะฝัะตััะตะนั + ะฟัะพะบัะธัะพะฒะฐะฝะธะต /api/ |
| **8000** | uvicorn (backend) | FastAPI REST API |

### Volumes

| Volume | ะะฐะทะฝะฐัะตะฝะธะต |
|--------|-----------|
| `./backend/data` โ `/app/data` | ะะตััะธััะตะฝัะฝะพะต ััะฐะฝะธะปะธัะต: SQLite, ChromaDB, ะธะทะพะฑัะฐะถะตะฝะธั |
| `./instructions` โ `/app/instructions` | HTML-ัะฐะนะปั ะธะฝััััะบัะธะน (read-only) |

### nginx

ะะพะฝัะธะณััะฐัะธั nginx ะฒ ะบะพะฝัะตะนะฝะตัะต frontend:
- `/` โ SPA-ัะพััะธะฝะณ (try_files โ index.html)
- `/api/` โ reverse proxy ะฝะฐ `http://backend:8000`
- `/static/images/` โ reverse proxy ะฝะฐ backend (ััะฐัะธัะตัะบะธะต ะธะทะพะฑัะฐะถะตะฝะธั)

### ะะพะผะฐะฝะดั ะดะตะฟะปะพั

```bash
# ะะตัะฒะธัะฝัะน ะดะตะฟะปะพะน
git clone https://github.com/rosavskiy/FBTPbot.git
cd FBTPbot
cp backend/.env.example backend/.env
# ะััะตะดะฐะบัะธัะพะฒะฐัั .env (ะบะปััะธ API)
docker compose up -d --build

# ะะฝะดะตะบัะฐัะธั ะฑะฐะทั ะทะฝะฐะฝะธะน (ะฟะพัะปะต ะทะฐะณััะทะบะธ HTML-ัะฐะนะปะพะฒ)
docker compose exec backend python -m app.indexer

# ะะฑะฝะพะฒะปะตะฝะธะต
git pull
docker compose up -d --build

# ะะพะณะธ
docker compose logs -f backend
docker compose logs -f frontend
```

---

## 13. ะะพะฝัะธะณััะฐัะธั (.env)

ะคะฐะนะป `backend/.env` ัะพะดะตัะถะธั ะฒัะต ะฝะฐัััะพะนะบะธ:

```env
# === OpenAI ===
OPENAI_API_KEY=sk-proj-...              # API-ะบะปัั OpenAI
OPENAI_MODEL=gpt-4o-mini                # ะะพะดะตะปั ะดะปั ะณะตะฝะตัะฐัะธะธ ะพัะฒะตัะพะฒ
OPENAI_EMBEDDING_MODEL=text-embedding-3-small  # ะะพะดะตะปั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ

# === ChromaDB ===
CHROMA_PERSIST_DIR=./data/chroma_db     # ะะธัะตะบัะพัะธั ััะฐะฝะตะฝะธั ะฒะตะบัะพัะฝะพะน ะะ

# === Database ===
DATABASE_URL=sqlite+aiosqlite:///./data/support.db  # SQLite

# === Telegram ===
TELEGRAM_BOT_TOKEN=...                  # ะขะพะบะตะฝ Telegram-ะฑะพัะฐ
TELEGRAM_SUPPORT_CHAT_ID=...            # ID ัะฐัะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน

# === Application ===
APP_HOST=0.0.0.0
APP_PORT=8000
APP_DEBUG=true

# === Instructions ===
INSTRUCTIONS_DIR=./instructions         # ะััั ะบ HTML-ัะฐะนะปะฐะผ ะฒะฝัััะธ Docker

# === RAG ===
RAG_CHUNK_SIZE=800                      # ะะฐะทะผะตั ัะฐะฝะบะฐ (ัะธะผะฒะพะปั)
RAG_CHUNK_OVERLAP=200                   # ะะตัะตะบัััะธะต ัะฐะฝะบะพะฒ
RAG_TOP_K=5                             # ะะพะปะธัะตััะฒะพ ะฒะพะทะฒัะฐัะฐะตะผัั ัะฐะฝะบะพะฒ
RAG_CONFIDENCE_THRESHOLD=0.3            # ะะพัะพะณ ัะฒะตัะตะฝะฝะพััะธ ะดะปั ััะบะฐะปะฐัะธะธ

# === CORS ===
CORS_ORIGINS=["http://localhost:3000","http://41.216.182.31"]
```

---

## 14. ะกัะตะผะฐ ะฟะพัะพะบะพะฒ ะดะฐะฝะฝัั

### ะะพัะพะบ 1: ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะดะฐัั ะฒะพะฟัะพั

```
ะัะฐัะทะตั โ POST /api/chat โ FastAPI
    โ ะกะพะทะดะฐัั/ะทะฐะณััะทะธัั ัะตััะธั (SQLite)
    โ ะกะพััะฐะฝะธัั ัะพะพะฑัะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั (SQLite)
    โ ะะฐะณััะทะธัั ะธััะพัะธั ัะฐัะฐ (SQLite, ะดะพ 10 ัะพะพะฑัะตะฝะธะน)
    โ RAG Engine:
        โ ะะพะธัะบ ะฒ ChromaDB (similarity search, top-5)
        โ ะัะปะธ 0 ัะตะทัะปััะฐัะพะฒ โ ะพัะฒะตั "ะฝะต ะฝะฐะนะดะตะฝะพ", confidence=0, ััะบะฐะปะฐัะธั
        โ ะัะปะธ ะตััั ัะตะทัะปััะฐัั:
            โ ะกัะพัะผะธัะพะฒะฐัั ะบะพะฝัะตะบัั ะธะท ัะฐะฝะบะพะฒ
            โ ะกะพะฑัะฐัั YouTube-ัััะปะบะธ ะธ ะธะทะพะฑัะฐะถะตะฝะธั ะธะท ะผะตัะฐะดะฐะฝะฝัั
            โ ะัะฟัะฐะฒะธัั ะฒ OpenAI GPT-4o-mini
            โ ะะพะปััะธัั ะพัะฒะตั + confidence JSON
            โ ะะฐัะฟะฐััะธัั confidence, ัะฑัะฐัั ะธะท ะพัะฒะตัะฐ
    โ ะกะพััะฐะฝะธัั ะพัะฒะตั ะฑะพัะฐ (SQLite)
    โ ะะตัะฝััั JSON (ะพัะฒะตั + confidence + source_articles + youtube + escalation flag)
```

### ะะพัะพะบ 2: ะญัะบะฐะปะฐัะธั ะฝะฐ ะพะฟะตัะฐัะพัะฐ

```
ะัะฐัะทะตั โ POST /api/escalation โ FastAPI
    โ ะะฐะณััะทะธัั ะธััะพัะธั ัะฐัะฐ (SQLite)
    โ ะกะพะทะดะฐัั Escalation (SQLite, status=pending)
    โ ะกัะพัะผะธัะพะฒะฐัั ัะฒะพะดะบั ะดะธะฐะปะพะณะฐ
    โ ะัะฟัะฐะฒะธัั ะฒ Telegram (TelegramNotifier)
    โ ะะพััะธัะฐัั ะฟะพะทะธัะธั ะฒ ะพัะตัะตะดะธ
    โ ะะตัะฝััั JSON (escalation_id, position)
```

### ะะพัะพะบ 3: ะะฟะตัะฐัะพั ะพัะฒะตัะฐะตั

```
ะะฐะฝะตะปั ะพะฟะตัะฐัะพัะฐ โ POST /api/operator/reply โ FastAPI
    โ ะัะพะฒะตัะธัั Bearer-ัะพะบะตะฝ
    โ ะะฐะนัะธ ััะบะฐะปะฐัะธั (SQLite)
    โ ะะพะฑะฐะฒะธัั ะพัะฒะตั ะฒ ัะฐั (SQLite, role=assistant, [ะะฟะตัะฐัะพั ะขะ])
    โ ะะฑะฝะพะฒะธัั ััะฐััั ััะบะฐะปะฐัะธะธ (resolved / in_progress)
    โ ะัะฟัะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธะต ะฒ Telegram
    โ ะะตัะฝััั OK
```

### ะะพัะพะบ 4: ะะฝะดะตะบัะฐัะธั ะฑะฐะทั ะทะฝะฐะฝะธะน

```
python -m app.indexer โ KnowledgeBaseIndexer
    โ InstructionParser.parse_directory()
        โ ะะปั ะบะฐะถะดะพะณะพ ะธะท 542 HTML-ัะฐะนะปะพะฒ:
            โ ะะทะฒะปะตัั ะทะฐะณะพะปะพะฒะพะบ, ัะตะบัั, ะธะทะพะฑัะฐะถะตะฝะธั, YouTube
            โ ะกะพััะฐะฝะธัั base64-ะธะทะพะฑัะฐะถะตะฝะธั ะฒ ./data/images/
    โ ะะปั ะบะฐะถะดะพะน ParsedInstruction:
        โ ะะฑะพะณะฐัะธัั ัะตะบัั (ะทะฐะณะพะปะพะฒะพะบ + YouTube-ัััะปะบะธ)
        โ ะะฐะทะฑะธัั ะฝะฐ ัะฐะฝะบะธ (800 ัะธะผะฒ., 200 overlap)
        โ ะกัะพัะผะธัะพะฒะฐัั ะผะตัะฐะดะฐะฝะฝัะต
    โ ะัะฟัะฐะฒะธัั ะฒัะต ัะฐะฝะบะธ ะฒ ChromaDB ัะตัะตะท Chroma.from_documents()
        โ OpenAI Embeddings API (text-embedding-3-small)
        โ ะกะพััะฐะฝะตะฝะธะต ะฒ ./data/chroma_db/
    โ ะะฐะฟะธัะฐัั ััะฐัะธััะธะบั ะฒ ./data/indexing_stats.json
```

---

## 15. ะะณัะฐะฝะธัะตะฝะธั ะธ ะธะทะฒะตััะฝัะต ะพัะพะฑะตะฝะฝะพััะธ

### ะขะตัะฝะธัะตัะบะธะต ะพะณัะฐะฝะธัะตะฝะธั

1. **OpenAI ะทะฐะฒะธัะธะผะพััั** โ ัะธััะตะผะฐ ััะตะฑัะตั ะดะพัััะฟ ะบ OpenAI API. ะะท ะะพััะธะธ (ะธ ััะดะฐ ะดััะณะธั ัััะฐะฝ) API ะฝะตะดะพัััะฟะตะฝ โ ะฝะตะพะฑัะพะดะธะผ ัะตัะฒะตั ะฒ ัะฐะทัะตััะฝะฝะพะน ััะธัะดะธะบัะธะธ (ัะตะบััะธะน ัะตัะฒะตั: ะกัะพะบะณะพะปัะผ, ะจะฒะตัะธั).

2. **ะะฒัะพัะธะทะฐัะธั ะพะฟะตัะฐัะพัะฐ** โ ะธัะฟะพะปัะทัะตััั in-memory token store (ะฝะต JWT, ะฝะต Redis). ะัะธ ะฟะตัะตะทะฐะฟััะบะต ะฑัะบะตะฝะดะฐ ะฒัะต ัะพะบะตะฝั ัะตัััััั. ะะปั production ัะตะบะพะผะตะฝะดัะตััั Redis ะธะปะธ JWT.

3. **ะะดะธะฝ ะดะตะผะพ-ะพะฟะตัะฐัะพั** โ ะปะพะณะธะฝ/ะฟะฐัะพะปั ะทะฐัะธั ะฒ ะบะพะดะต (ัะผ. `.env`). ะขะฐะฑะปะธัะฐ `operators` ะฒ ะะ ัััะตััะฒัะตั, ะฝะพ ะฝะต ะธัะฟะพะปัะทัะตััั ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ.

4. **ะะฐะทะผะตั ะบะพะฝัะตะบััะฐ** โ ะฟัะธ ะฑะพะปััะพะผ ะบะพะปะธัะตััะฒะต ะฝะฐะนะดะตะฝะฝัั ัะฐะฝะบะพะฒ ะบะพะฝัะตะบัั ะผะพะถะตั ะฑััั ะพะฑััะผะฝัะผ. GPT-4o-mini ะฟะพะดะดะตัะถะธะฒะฐะตั ะดะพ 128K ัะพะบะตะฝะพะฒ, ะฝะพ ะธัะฟะพะปัะทัะตััั ะปะธะผะธั 2000 ัะพะบะตะฝะพะฒ ะฝะฐ ะพัะฒะตั.

5. **ะะตั ะฟะพัะพะบะพะฒะพะณะพ ะฒัะฒะพะดะฐ (streaming)** โ ะพัะฒะตั GPT ะฒะพะทะฒัะฐัะฐะตััั ัะตะปะธะบะพะผ, ะฑะตะท ะฟะพััะตะฟะตะฝะฝะพะณะพ ะพัะพะฑัะฐะถะตะฝะธั.

### ะัะพะฑะตะฝะฝะพััะธ RAG

1. **ะะพัะพะณ 0.3** โ ะดะพััะฐัะพัะฝะพ ะฐะณัะตััะธะฒะฝัะน ัะธะปััั. ะัะปะธ ัะพัะผัะปะธัะพะฒะบะฐ ะฒะพะฟัะพัะฐ ัะธะปัะฝะพ ะพัะปะธัะฐะตััั ะพั ัะตะบััะฐ ะธะฝััััะบัะธะธ, ัะตะปะตะฒะฐะฝัะฝัะต ัะฐะฝะบะธ ะผะพะณัั ะฑััั ะพััะธะปัััะพะฒะฐะฝั.

2. **Confidence=0.0 ะฟัะธ ะฟัััะพะผ retrieval** โ ะตัะปะธ ChromaDB ะฝะต ะฝะฐััะป ะฝะธัะตะณะพ ะฒััะต ะฟะพัะพะณะฐ, GPT ะฒะพะพะฑัะต ะฝะต ะฒัะทัะฒะฐะตััั, ะธ confidence ะฐะฒัะพะผะฐัะธัะตัะบะธ 0.0.

3. **ะกะฐะผะพะพัะตะฝะบะฐ GPT** โ confidence ะณะตะฝะตัะธััะตััั ัะฐะผะพะน ะผะพะดะตะปัั, ััะพ ะผะพะถะตั ะฑััั ะฝะตัะพัะฝัะผ. ะะพะดะตะปั ะผะพะถะตั ะทะฐะฒััะฐัั ะธะปะธ ะทะฐะฝะธะถะฐัั ะพัะตะฝะบั.

4. **ะััะพัะธั ัะฐัะฐ** โ ะฒ RAG ะฟะตัะตะดะฐัััั ะฟะพัะปะตะดะฝะธะต 6 ัะพะพะฑัะตะฝะธะน, ััะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะบะพะฝัะตะบัััะฐะปัะฝะพััั, ะฝะพ ะฟัะธ ะดะปะธะฝะฝัั ะดะธะฐะปะพะณะฐั ัะฐะฝะฝะธะต ัะพะพะฑัะตะฝะธั ัะตัััััั.

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะปัััะตะฝะธั

1. **Streaming-ะพัะฒะตัั** โ ะดะพะฑะฐะฒะธัั SSE/WebSocket ะดะปั ะฟะพััะตะฟะตะฝะฝะพะณะพ ะพัะพะฑัะฐะถะตะฝะธั ะพัะฒะตัะฐ
2. **JWT-ะฐะฒัะพัะธะทะฐัะธั** โ ะดะปั production-ััะตะดั
3. **ะะพะฝะธัะพัะธะฝะณ** โ Prometheus/Grafana ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะผะตััะธะบ (ะฒัะตะผั ะพัะฒะตัะฐ, confidence distribution, ะบะพะปะธัะตััะฒะพ ััะบะฐะปะฐัะธะน)
4. **A/B ัะตััะธัะพะฒะฐะฝะธะต ะฟัะพะผะฟัะพะฒ** โ ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะบะฐัะตััะฒะฐ ะพัะฒะตัะพะฒ
5. **ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะฑะฐะทั ะทะฝะฐะฝะธะน** โ ััะบ ะดะปั ะฟะตัะตะธะฝะดะตะบัะฐัะธะธ ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ ะธะฝััััะบัะธะน
6. **ะะตัะธัะพะฒะฐะฝะธะต** โ ัะฐัััะต ะฒะพะฟัะพัั ะผะพะถะฝะพ ะบะตัะธัะพะฒะฐัั ะดะปั ััะบะพัะตะฝะธั ะธ ัะบะพะฝะพะผะธะธ ัะพะบะตะฝะพะฒ
